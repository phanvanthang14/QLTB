<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Import device - AssetFlow IT</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="css/shared.css">
  <link rel="stylesheet" href="css/import-device.css">
</head>
<body>
  <header class="header">
    <div class="header-content">
      <div class="header-left">
        <button class="sidebar-toggle" title="Toggle Sidebar">â˜°</button>
        <a href="index.html" class="logo">
          <div class="logo-icon">ðŸ’»</div>
          <span>AssetFlow IT</span>
        </a>
      </div>
      <div class="header-right">
        <button class="mobile-menu-toggle">â˜°</button>
      </div>
    </div>
  </header>

  <div class="sidebar">
    <div class="sidebar-content">
      <div class="sidebar-section">
        <div class="sidebar-section-header">Admin desktop</div>
        <a href="dashboard.html" class="sidebar-item" data-title="Dashboard">
          <i class="fas fa-th-large sidebar-item-icon"></i>
          <span>Dashboard</span>
        </a>
        <a href="index.html" class="sidebar-item" data-title="Device list">
          <i class="fas fa-box sidebar-item-icon"></i>
          <span>Device List</span>
        </a>
        <a href="import-device.html" class="sidebar-item active" data-title="Import device">
          <i class="fas fa-file-import sidebar-item-icon"></i>
          <span>Import Device</span>
        </a>
        <a href="user-list.html" class="sidebar-item" data-title="User list">
          <i class="fas fa-users sidebar-item-icon"></i>
          <span>User List</span>
        </a>
      </div>
      
      <div class="sidebar-section">
        <div class="sidebar-section-header">Mobile/tablet UI</div>
        <a href="qr-scan.html" class="sidebar-item" data-title="QR scan">
          <i class="fas fa-qrcode sidebar-item-icon"></i>
          <span>QR scan</span>
        </a>
      </div>
    </div>
    
    <div class="sidebar-user-profile">
      <div class="user-profile">
        <div class="user-avatar">JD</div>
        <div class="user-info">
          <span class="user-name">John Doe</span>
          <span class="user-email">johndoe@company.com</span>
        </div>
      </div>
    </div>
  </div>

  <main class="main-content">
    <h1 class="page-title">Import device</h1>
    <div class="import-container">
      <div class="import-card">
        <h2 style="margin-bottom: 1.5rem;">Upload Excel file</h2>
        
        <div class="upload-area" id="uploadArea">
          <div class="upload-icon">ðŸ“„</div>
          <div class="upload-text">Drop Excel file here or click to browse</div>
          <div class="upload-hint">Supports .xlsx, .xls files (max 10MB)</div>
        </div>
        
        <input type="file" id="fileInput" class="file-input" accept=".xlsx,.xls">
        
        <div class="file-info" id="fileInfo">
          <div class="file-name" id="fileName"></div>
          <div class="file-size" id="fileSize"></div>
          <button class="btn btn-danger" style="margin-top: 0.5rem;" onclick="clearFile()">Remove</button>
        </div>
        
        <div class="progress-bar" id="progressBar">
          <div class="progress-fill" id="progressFill"></div>
        </div>
      </div>
      
      <div class="template-download">
        <h3 style="margin-bottom: 0.5rem;">Need a template?</h3>
        <p style="color: var(--text-secondary); font-size: 0.875rem;">Download our Excel template to ensure proper formatting</p>
        <a href="#" class="template-link" onclick="downloadTemplate()">
          <span>ðŸ“¥</span>
          <span>Download template</span>
        </a>
      </div>
      
      <div class="import-card" id="previewCard" style="display: none;">
        <h2 style="margin-bottom: 1.5rem;">Preview data</h2>
        
        <div class="import-summary" id="importSummary"></div>
        
        <div style="overflow-x: auto; margin-top: 1.5rem;">
          <table class="preview-table" id="previewTable">
            <thead>
              <tr>
                <th>Row</th>
                <th>Name</th>
                <th>Type</th>
                <th>Serial number</th>
                <th>Category</th>
                <th>Status</th>
                <th>Location</th>
              </tr>
            </thead>
            <tbody id="previewTableBody"></tbody>
          </table>
        </div>
        
        <div style="display: flex; gap: 1rem; margin-top: 2rem;">
          <button class="btn btn-primary" onclick="importDevices()">Import Devices</button>
          <button class="btn btn-secondary" onclick="cancelImport()">Cancel</button>
        </div>
      </div>
    </div>
  </main>

  <script src="js/shared.js"></script>
  <script>
    let fileData = null;
    
    const uploadArea = document.getElementById('uploadArea');
    const fileInput = document.getElementById('fileInput');
    const fileInfo = document.getElementById('fileInfo');
    
    uploadArea.addEventListener('click', () => fileInput.click());
    
    uploadArea.addEventListener('dragover', (e) => {
      e.preventDefault();
      uploadArea.classList.add('dragover');
    });
    
    uploadArea.addEventListener('dragleave', () => {
      uploadArea.classList.remove('dragover');
    });
    
    uploadArea.addEventListener('drop', (e) => {
      e.preventDefault();
      uploadArea.classList.remove('dragover');
      const files = e.dataTransfer.files;
      if (files.length > 0) {
        handleFile(files[0]);
      }
    });
    
    fileInput.addEventListener('change', (e) => {
      if (e.target.files.length > 0) {
        handleFile(e.target.files[0]);
      }
    });
    
    function handleFile(file) {
      if (!file.name.match(/\.(xlsx|xls)$/i)) {
        AssetFlowUtils.showToast('Please upload an Excel file (.xlsx or .xls)', 'error');
        return;
      }
      
      if (file.size > 10 * 1024 * 1024) {
        AssetFlowUtils.showToast('File size must be less than 10MB', 'error');
        return;
      }
      
      document.getElementById('fileName').textContent = file.name;
      document.getElementById('fileSize').textContent = formatFileSize(file.size);
      fileInfo.classList.add('show');
      
      // Simulate file parsing
      simulateFileParse(file);
    }
    
    function formatFileSize(bytes) {
      if (bytes === 0) return '0 Bytes';
      const k = 1024;
      const sizes = ['Bytes', 'KB', 'MB'];
      const i = Math.floor(Math.log(bytes) / Math.log(k));
      return Math.round(bytes / Math.pow(k, i) * 100) / 100 + ' ' + sizes[i];
    }
    
    function simulateFileParse(file) {
      const progressBar = document.getElementById('progressBar');
      const progressFill = document.getElementById('progressFill');
      
      progressBar.classList.add('show');
      
      let progress = 0;
      const interval = setInterval(() => {
        progress += 10;
        progressFill.style.width = progress + '%';
        
        if (progress >= 100) {
          clearInterval(interval);
          setTimeout(() => {
            progressBar.classList.remove('show');
            showPreview();
          }, 500);
        }
      }, 200);
    }
    
    function showPreview() {
      // Mock data for preview
      const mockData = [
        { name: 'HP EliteBook 840', type: 'Laptop', serial: 'HP840-001', category: 'Container', status: 'IN_STOCK', location: 'Warehouse A', valid: true },
        { name: 'Dell Monitor 27"', type: 'Monitor', serial: 'DELL27-001', category: 'Container', status: 'IN_STOCK', location: 'Warehouse A', valid: true },
        { name: 'Logitech MX Master 3', type: 'Mouse', serial: 'LOGIMX-001', category: 'Component', status: 'IN_STOCK', location: 'Warehouse A', valid: true },
        { name: 'Invalid Device', type: '', serial: '', category: '', status: '', location: '', valid: false, error: 'Missing required fields' }
      ];
      
      fileData = mockData;
      
      const summary = {
        total: mockData.length,
        valid: mockData.filter(d => d.valid).length,
        invalid: mockData.filter(d => !d.valid).length
      };
      
      document.getElementById('importSummary').innerHTML = `
        <div class="summary-card">
          <div class="summary-value" style="color: var(--text-primary);">${summary.total}</div>
          <div class="summary-label">Total Rows</div>
        </div>
        <div class="summary-card">
          <div class="summary-value" style="color: var(--success-color);">${summary.valid}</div>
          <div class="summary-label">Valid</div>
        </div>
        <div class="summary-card">
          <div class="summary-value" style="color: var(--danger-color);">${summary.invalid}</div>
          <div class="summary-label">Invalid</div>
        </div>
      `;
      
      const tbody = document.getElementById('previewTableBody');
      tbody.innerHTML = '';
      
      mockData.forEach((row, index) => {
        const tr = document.createElement('tr');
        if (!row.valid) tr.classList.add('error');
        
        tr.innerHTML = `
          <td>${index + 1}</td>
          <td>${row.name || '-'}</td>
          <td>${row.type || '-'}</td>
          <td>${row.serial || '-'}</td>
          <td>${row.category || '-'}</td>
          <td>${row.status ? AssetFlowUtils.getStatusDisplayName(row.status) : '-'}</td>
          <td>${row.location || '-'}</td>
        `;
        
        if (row.error) {
          const errorCell = document.createElement('td');
          errorCell.innerHTML = `<div class="error-message">${row.error}</div>`;
          tr.appendChild(errorCell);
        }
        
        tbody.appendChild(tr);
      });
      
      document.getElementById('previewCard').style.display = 'block';
      document.getElementById('previewCard').scrollIntoView({ behavior: 'smooth' });
    }
    
    function importDevices() {
      if (!fileData) return;
      
      const validDevices = fileData.filter(d => d.valid);
      if (validDevices.length === 0) {
        AssetFlowUtils.showToast('No valid devices to import', 'error');
        return;
      }
      
      const progressBar = document.getElementById('progressBar');
      const progressFill = document.getElementById('progressFill');
      
      progressBar.classList.add('show');
      progressFill.style.width = '0%';
      
      let progress = 0;
      const interval = setInterval(() => {
        progress += 20;
        progressFill.style.width = progress + '%';
        
        if (progress >= 100) {
          clearInterval(interval);
          setTimeout(() => {
            progressBar.classList.remove('show');
            AssetFlowUtils.showToast(`Successfully imported ${validDevices.length} device(s)`, 'success');
            setTimeout(() => {
              window.location.href = 'device-list.html';
            }, 1500);
          }, 500);
        }
      }, 300);
    }
    
    function cancelImport() {
      document.getElementById('previewCard').style.display = 'none';
      clearFile();
    }
    
    function clearFile() {
      fileInput.value = '';
      fileInfo.classList.remove('show');
      fileData = null;
      document.getElementById('previewCard').style.display = 'none';
    }
    
    function downloadTemplate() {
      AssetFlowUtils.showToast('Template download started', 'success');
      // In real implementation, this would download an actual Excel template
    }
  </script>
</body>
</html>

