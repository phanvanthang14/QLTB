<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>User list - AssetFlow IT</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="css/shared.css">
  <link rel="stylesheet" href="css/user-list.css">
</head>
<body>
  <header class="header">
    <div class="header-content">
      <div class="header-left">
        <button class="sidebar-toggle" title="Toggle Sidebar">‚ò∞</button>
        <a href="index.html" class="logo">
          <div class="logo-icon">üíª</div>
          <span>AssetFlow IT</span>
        </a>
      </div>
      <div class="header-right">
        <button class="mobile-menu-toggle">‚ò∞</button>
      </div>
    </div>
  </header>

  <div class="sidebar">
    <div class="sidebar-content">
      <div class="sidebar-section">
        <a href="device-list.html" class="sidebar-item" data-title="Device list">
          <i class="fas fa-box sidebar-item-icon"></i>
          <span>Device List</span>
        </a>
        <a href="user-list.html" class="sidebar-item active" data-title="User list">
          <i class="fas fa-users sidebar-item-icon"></i>
          <span>User List</span>
        </a>
        <a href="qr-scan.html" class="sidebar-item" data-title="QR scan">
          <i class="fas fa-qrcode sidebar-item-icon"></i>
          <span>QR scan</span>
        </a>
      </div>
    </div>
    
    <div class="sidebar-user-profile">
      <div class="user-profile">
        <div class="user-avatar">JD</div>
        <div class="user-info">
          <span class="user-name">John Doe</span>
          <span class="user-email">johndoe@company.com</span>
        </div>
      </div>
    </div>
  </div>

  <main class="main-content">
    <h1 class="page-title">User management</h1>
    <!-- Search and Filter Bar -->
    <div class="search-filter-bar">
      <div class="search-input-wrapper">
        <i class="fas fa-search search-icon"></i>
        <input type="text" class="search-input-main" id="searchInput" placeholder="Search by name, email, department...">
      </div>
      <div class="custom-dropdown" id="roleDropdown">
        <button class="custom-dropdown-button" type="button">
          <span class="custom-dropdown-text">All roles</span>
          <i class="fas fa-chevron-down custom-dropdown-icon"></i>
        </button>
        <div class="custom-dropdown-menu">
          <div class="custom-dropdown-option" data-value="">All roles</div>
          <div class="custom-dropdown-option" data-value="Employee">Employee</div>
          <div class="custom-dropdown-option" data-value="Technician">Technician</div>
          <div class="custom-dropdown-option" data-value="Admin">Admin</div>
        </div>
        <select class="filter-dropdown hidden" id="roleFilter">
          <option value="">All roles</option>
          <option value="Employee">Employee</option>
          <option value="Technician">Technician</option>
          <option value="Admin">Admin</option>
        </select>
      </div>
      <div class="custom-dropdown" id="teamDropdown">
        <button class="custom-dropdown-button" type="button">
          <span class="custom-dropdown-text">All teams</span>
          <i class="fas fa-chevron-down custom-dropdown-icon"></i>
        </button>
        <div class="custom-dropdown-menu">
          <div class="custom-dropdown-option" data-value="">All teams</div>
        </div>
        <select class="filter-dropdown hidden" id="teamFilter">
          <option value="">All teams</option>
        </select>
      </div>
    </div>
    
    <!-- Advanced Filters (Hidden by default, can be expanded) -->
    <div class="advanced-filters-collapsed" id="advancedFilters">
      <div class="advanced-filters-content">
      </div>
    </div>
    
    <div class="toolbar">
      <div class="toolbar-left">
        <button class="btn btn-primary add-device-btn">
          <span class="add-icon">+</span>
          <span>Add user</span>
        </button>
      </div>
    </div>

    <div class="table-controls">
      <div class="table-info">
        <span id="tableInfo">Showing 0 users</span>
      </div>
      <div class="table-pagination-controls">
        <select class="page-size-select" id="pageSizeSelect">
          <option value="10">10 per page</option>
          <option value="25" selected>25 per page</option>
          <option value="50">50 per page</option>
          <option value="100">100 per page</option>
        </select>
      </div>
    </div>

    <div class="user-table-wrapper">
      <table class="user-table" id="userTable">
        <thead>
          <tr>
            <th class="sortable" data-sort="name">
              <div class="th-content">
                <span>Name</span>
                <span class="sort-indicator"></span>
              </div>
            </th>
            <th class="sortable" data-sort="email">
              <div class="th-content">
                <span>Email</span>
                <span class="sort-indicator"></span>
              </div>
            </th>
            <th class="sortable" data-sort="department">
              <div class="th-content">
                <span>Department</span>
                <span class="sort-indicator"></span>
              </div>
            </th>
            <th class="sortable" data-sort="team">
              <div class="th-content">
                <span>Team</span>
                <span class="sort-indicator"></span>
              </div>
            </th>
            <th class="sortable" data-sort="position">
              <div class="th-content">
                <span>Position</span>
                <span class="sort-indicator"></span>
              </div>
            </th>
            <th class="sortable" data-sort="role">
              <div class="th-content">
                <span>Role</span>
                <span class="sort-indicator"></span>
              </div>
            </th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody id="userTableBody"></tbody>
      </table>
    </div>

    <div class="table-pagination" id="tablePagination"></div>
  </main>

  <!-- Add User Modal -->
  <div class="modal-overlay" id="addUserModal">
    <div class="modal-content add-user-modal">
      <div class="modal-header">
        <h2>Add new user</h2>
        <button class="modal-close" onclick="closeAddUserModal()">√ó</button>
      </div>
      <form id="addUserForm" onsubmit="handleAddUser(event)">
        <div class="form-row">
          <div class="form-group">
            <label>Name <span class="required">*</span></label>
            <input type="text" id="userName" class="form-input" required>
          </div>
          <div class="form-group">
            <label>Email <span class="required">*</span></label>
            <input type="email" id="userEmail" class="form-input" required>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label>Department <span class="required">*</span></label>
            <input type="text" id="userDepartment" class="form-input" required placeholder="e.g., Engineering">
          </div>
          <div class="form-group">
            <label>Team <span class="required">*</span></label>
            <input type="text" id="userTeam" class="form-input" required placeholder="e.g., Engineering">
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label>Position <span class="required">*</span></label>
            <input type="text" id="userPosition" class="form-input" required placeholder="e.g., Software Developer">
          </div>
          <div class="form-group">
            <label>Role <span class="required">*</span></label>
            <select id="userRole" class="form-input" required>
              <option value="Employee">Employee</option>
              <option value="Technician">Technician</option>
              <option value="Admin">Admin</option>
            </select>
          </div>
        </div>

        <div class="modal-actions">
          <button type="button" class="btn btn-secondary" onclick="closeAddUserModal()">Cancel</button>
          <button type="submit" class="btn btn-primary">Add user</button>
        </div>
      </form>
    </div>
  </div>

  <script src="js/shared.js"></script>
  <script>
    let allUsers = [];
    let filteredUsers = [];
    let sortedUsers = [];
    let paginatedUsers = [];
    
    let originalUsers = [];
    
    // Sorting and pagination state
    let currentSort = { column: null, direction: 'asc' };
    let currentPage = 1;
    let pageSize = 25;
    
    // Store debounced functions to allow proper cleanup
    let debouncedFilterUsers = null;
    
    async function loadUsers() {
      originalUsers = await AssetFlowUtils.loadJSON('data/users.json');
      allUsers = [...originalUsers];
      filteredUsers = [...allUsers];
      
      populateFilters();
      applySorting();
      renderUsers();
      
      // Initialize event listeners after users are loaded
      initializeEventListeners();
      initializeSearchInput();
      initializeCustomDropdowns();
    }
    
    // Initialize search input on page load
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initializeSearchInput);
    } else {
      initializeSearchInput();
    }
    
    function populateFilters() {
      const departments = [...new Set(allUsers.map(u => u.department).filter(Boolean))].sort();
      const teams = [...new Set(allUsers.map(u => u.team).filter(Boolean))].sort();
      
      // Populate department dropdown
      const deptSelect = document.getElementById('departmentFilter');
      const deptDropdown = document.getElementById('departmentDropdown');
      const deptMenu = deptDropdown?.querySelector('.custom-dropdown-menu');
      
      if (deptSelect && deptMenu) {
        deptSelect.innerHTML = '<option value="">All departments</option>';
        deptMenu.innerHTML = '<div class="custom-dropdown-option" data-value="">All departments</div>';
        
        departments.forEach(dept => {
          const option = document.createElement('option');
          option.value = dept;
          option.textContent = dept;
          deptSelect.appendChild(option);
          
          const optionDiv = document.createElement('div');
          optionDiv.className = 'custom-dropdown-option';
          optionDiv.dataset.value = dept;
          optionDiv.textContent = dept;
          deptMenu.appendChild(optionDiv);
        });
      }
      
      // Populate team dropdown
      const teamSelect = document.getElementById('teamFilter');
      const teamDropdown = document.getElementById('teamDropdown');
      const teamMenu = teamDropdown?.querySelector('.custom-dropdown-menu');
      
      if (teamSelect && teamMenu) {
        teamSelect.innerHTML = '<option value="">All teams</option>';
        teamMenu.innerHTML = '<div class="custom-dropdown-option" data-value="">All teams</div>';
        
        teams.forEach(team => {
          const option = document.createElement('option');
          option.value = team;
          option.textContent = team;
          teamSelect.appendChild(option);
          
          const optionDiv = document.createElement('div');
          optionDiv.className = 'custom-dropdown-option';
          optionDiv.dataset.value = team;
          optionDiv.textContent = team;
          teamMenu.appendChild(optionDiv);
        });
      }
    }
    
    function filterUsers() {
      const searchTerm = document.getElementById('searchInput')?.value.toLowerCase() || '';
      const roleFilter = document.getElementById('roleFilter')?.value || '';
      const departmentFilter = document.getElementById('departmentFilter')?.value || '';
      const teamFilter = document.getElementById('teamFilter')?.value || '';
      
      filteredUsers = allUsers.filter(user => {
        const matchesSearch = !searchTerm || 
          user.name.toLowerCase().includes(searchTerm) ||
          user.email.toLowerCase().includes(searchTerm) ||
          (user.department && user.department.toLowerCase().includes(searchTerm)) ||
          (user.team && user.team.toLowerCase().includes(searchTerm)) ||
          (user.position && user.position.toLowerCase().includes(searchTerm));
        
        const matchesRole = !roleFilter || user.role === roleFilter;
        const matchesDepartment = !departmentFilter || user.department === departmentFilter;
        const matchesTeam = !teamFilter || user.team === teamFilter;
        
        return matchesSearch && matchesRole && matchesDepartment && matchesTeam;
      });
      
      currentPage = 1;
      applySorting();
      renderUsers();
    }
    
    function applySorting() {
      sortedUsers = [...filteredUsers];
      
      if (currentSort.column) {
        sortedUsers.sort((a, b) => {
          let aValue = a[currentSort.column] || '';
          let bValue = b[currentSort.column] || '';
          
          if (!aValue && !bValue) return 0;
          if (!aValue) return 1;
          if (!bValue) return -1;
          
          if (typeof aValue === 'string' && typeof bValue === 'string') {
            const comparison = aValue.localeCompare(bValue, undefined, { numeric: true, sensitivity: 'base' });
            return currentSort.direction === 'asc' ? comparison : -comparison;
          }
          
          return currentSort.direction === 'asc' 
            ? (aValue > bValue ? 1 : -1)
            : (aValue < bValue ? 1 : -1);
        });
      }
      
      const startIndex = (currentPage - 1) * pageSize;
      const endIndex = startIndex + pageSize;
      paginatedUsers = sortedUsers.slice(startIndex, endIndex);
    }
    
    function sortTable(column) {
      if (currentSort.column === column) {
        currentSort.direction = currentSort.direction === 'asc' ? 'desc' : 'asc';
      } else {
        currentSort.column = column;
        currentSort.direction = 'asc';
      }
      
      document.querySelectorAll('.sortable').forEach(th => {
        const indicator = th.querySelector('.sort-indicator');
        if (th.dataset.sort === column) {
          th.classList.add('sorted');
          indicator.textContent = currentSort.direction === 'asc' ? '‚Üë' : '‚Üì';
        } else {
          th.classList.remove('sorted');
          indicator.textContent = '';
        }
      });
      
      applySorting();
      renderUsers();
    }
    
    function changePage(page) {
      currentPage = page;
      applySorting();
      renderUsers();
    }
    
    function changePageSize(size) {
      pageSize = parseInt(size);
      currentPage = 1;
      applySorting();
      renderUsers();
    }
    
    function renderPagination() {
      const totalPages = Math.ceil(sortedUsers.length / pageSize);
      const paginationContainer = document.getElementById('tablePagination');
      
      if (totalPages <= 1) {
        paginationContainer.innerHTML = '';
        return;
      }
      
      let paginationHTML = '<div class="pagination-controls">';
      
      paginationHTML += `
        <button class="pagination-btn" ${currentPage === 1 ? 'disabled' : ''} onclick="changePage(${currentPage - 1})">
          ‚Üê Previous
        </button>
      `;
      
      const maxVisiblePages = 7;
      let startPage = Math.max(1, currentPage - Math.floor(maxVisiblePages / 2));
      let endPage = Math.min(totalPages, startPage + maxVisiblePages - 1);
      
      if (endPage - startPage < maxVisiblePages - 1) {
        startPage = Math.max(1, endPage - maxVisiblePages + 1);
      }
      
      if (startPage > 1) {
        paginationHTML += `<button class="pagination-btn" onclick="changePage(1)">1</button>`;
        if (startPage > 2) {
          paginationHTML += `<span class="pagination-ellipsis">...</span>`;
        }
      }
      
      for (let i = startPage; i <= endPage; i++) {
        paginationHTML += `
          <button class="pagination-btn ${i === currentPage ? 'active' : ''}" onclick="changePage(${i})">
            ${i}
          </button>
        `;
      }
      
      if (endPage < totalPages) {
        if (endPage < totalPages - 1) {
          paginationHTML += `<span class="pagination-ellipsis">...</span>`;
        }
        paginationHTML += `<button class="pagination-btn" onclick="changePage(${totalPages})">${totalPages}</button>`;
      }
      
      paginationHTML += `
        <button class="pagination-btn" ${currentPage === totalPages ? 'disabled' : ''} onclick="changePage(${currentPage + 1})">
          Next ‚Üí
        </button>
      `;
      
      paginationHTML += '</div>';
      paginationContainer.innerHTML = paginationHTML;
    }
    
    function renderUsers() {
      const tbody = document.getElementById('userTableBody');
      tbody.innerHTML = '';
      
      const startIndex = (currentPage - 1) * pageSize + 1;
      const endIndex = Math.min(currentPage * pageSize, sortedUsers.length);
      const totalCount = sortedUsers.length;
      
      document.getElementById('tableInfo').textContent = 
        totalCount === 0 
          ? ''
          : `Showing ${startIndex}-${endIndex} of ${totalCount} users`;
      
      if (paginatedUsers.length === 0) {
        tbody.innerHTML = '';
        renderPagination();
        return;
      }
      
      paginatedUsers.forEach((user, index) => {
        const row = document.createElement('tr');
        row.className = 'animate-fade-in';
        
        const roleBadgeClass = user.role === 'Admin' ? 'role-admin' : 
                               user.role === 'Technician' ? 'role-technician' : 'role-employee';
        
        row.innerHTML = `
          <td>
            <div class="user-name-cell">
              <div class="user-avatar-small">${user.name.charAt(0).toUpperCase()}</div>
              <span>${user.name}</span>
            </div>
          </td>
          <td>
            <div class="user-email" title="${user.email}">${user.email}</div>
          </td>
          <td>
            <span>${user.department || '-'}</span>
          </td>
          <td>
            <span>${user.team || '-'}</span>
          </td>
          <td>
            <span>${user.position || '-'}</span>
          </td>
          <td>
            <span class="role-badge ${roleBadgeClass}">${user.role}</span>
          </td>
          <td>
            <div style="display: flex; gap: 0.5rem;">
              <button class="btn btn-icon btn-secondary user-action-btn user-action-edit" onclick="editUser('${user.id}')" title="Edit">
                <i class="fas fa-edit"></i>
              </button>
              <button class="btn btn-icon btn-secondary user-action-btn user-action-delete" onclick="deleteUser('${user.id}')" title="Delete">
                <i class="fas fa-trash"></i>
              </button>
            </div>
          </td>
        `;
        
        tbody.appendChild(row);
      });
      
      renderPagination();
    }
    
    function openAddUserModal() {
      const modal = document.getElementById('addUserModal');
      modal.classList.add('active');
      document.body.style.overflow = 'hidden';
      resetForm();
    }
    
    function closeAddUserModal() {
      const modal = document.getElementById('addUserModal');
      modal.classList.remove('active');
      document.body.style.overflow = '';
      resetForm();
    }
    
    function resetForm() {
      document.getElementById('addUserForm').reset();
    }
    
    async function handleAddUser(event) {
      event.preventDefault();
      
      const formData = {
        name: document.getElementById('userName').value.trim(),
        email: document.getElementById('userEmail').value.trim(),
        department: document.getElementById('userDepartment').value.trim(),
        team: document.getElementById('userTeam').value.trim(),
        position: document.getElementById('userPosition').value.trim(),
        role: document.getElementById('userRole').value
      };
      
      // Generate ID
      const maxId = originalUsers.reduce((max, u) => {
        const num = parseInt(u.id.replace(/\D/g, ''));
        return num > max ? num : max;
      }, 0);
      
      const prefix = formData.role === 'Admin' ? 'ADMIN' : 
                     formData.role === 'Technician' ? 'TECH' : 'EMP';
      formData.id = `${prefix}${String(maxId + 1).padStart(3, '0')}`;
      
      originalUsers.push(formData);
      
      // Save to JSON (in production, this would be an API call)
      localStorage.setItem('users_backup', JSON.stringify(originalUsers, null, 2));
      console.log('User data updated. In production, this should be saved to a backend API.');
      
      alert('User added successfully!');
      closeAddUserModal();
      loadUsers();
    }
    
    function editUser(id) {
      const user = originalUsers.find(u => u.id === id);
      if (!user) return;
      
      // For now, just show an alert. In production, open edit modal
      alert(`Edit user: ${user.name}\nThis feature will be implemented soon.`);
    }
    
    function deleteUser(id) {
      const user = originalUsers.find(u => u.id === id);
      if (!user) return;
      
      if (confirm(`Are you sure you want to delete ${user.name}?`)) {
        const index = originalUsers.findIndex(u => u.id === id);
        if (index > -1) {
          originalUsers.splice(index, 1);
          localStorage.setItem('users_backup', JSON.stringify(originalUsers, null, 2));
          loadUsers();
        }
      }
    }
    
    // Initialize custom dropdowns
    function initializeCustomDropdowns() {
      // Role Dropdown
      const roleDropdown = document.getElementById('roleDropdown');
      if (roleDropdown) {
        const button = roleDropdown.querySelector('.custom-dropdown-button');
        const menu = roleDropdown.querySelector('.custom-dropdown-menu');
        const hiddenSelect = roleDropdown.querySelector('select');
        const options = menu.querySelectorAll('.custom-dropdown-option');
        
        // Set initial selected option
        const firstOption = menu.querySelector('.custom-dropdown-option[data-value=""]');
        if (firstOption) firstOption.classList.add('selected');
        
        button.addEventListener('click', (e) => {
          e.stopPropagation();
          const isOpen = menu.classList.contains('show');
          closeAllDropdowns();
          if (!isOpen) {
            menu.classList.add('show');
            button.classList.add('active');
          }
        });
        
        options.forEach(option => {
          option.addEventListener('click', (e) => {
            e.stopPropagation();
            const value = option.dataset.value || '';
            const text = option.textContent;
            
            button.querySelector('.custom-dropdown-text').textContent = text;
            options.forEach(opt => opt.classList.remove('selected'));
            option.classList.add('selected');
            
            if (hiddenSelect) {
              hiddenSelect.value = value;
              hiddenSelect.dispatchEvent(new Event('change'));
            }
            
            menu.classList.remove('show');
            button.classList.remove('active');
            filterUsers();
          });
        });
      }
      
      // Department Dropdown
      const departmentDropdown = document.getElementById('departmentDropdown');
      if (departmentDropdown) {
        const button = departmentDropdown.querySelector('.custom-dropdown-button');
        const menu = departmentDropdown.querySelector('.custom-dropdown-menu');
        const hiddenSelect = departmentDropdown.querySelector('select');
        
        // Set initial selected option
        const firstOption = menu.querySelector('.custom-dropdown-option[data-value=""]');
        if (firstOption) firstOption.classList.add('selected');
        
        button.addEventListener('click', (e) => {
          e.stopPropagation();
          const isOpen = menu.classList.contains('show');
          closeAllDropdowns();
          if (!isOpen) {
            menu.classList.add('show');
            button.classList.add('active');
          }
        });
        
        menu.addEventListener('click', (e) => {
          const option = e.target.closest('.custom-dropdown-option');
          if (option) {
            e.stopPropagation();
            const value = option.dataset.value || '';
            const text = option.textContent;
            
            button.querySelector('.custom-dropdown-text').textContent = text;
            menu.querySelectorAll('.custom-dropdown-option').forEach(opt => opt.classList.remove('selected'));
            option.classList.add('selected');
            
            if (hiddenSelect) {
              hiddenSelect.value = value;
              hiddenSelect.dispatchEvent(new Event('change'));
            }
            
            menu.classList.remove('show');
            button.classList.remove('active');
            filterUsers();
          }
        });
      }
      
      // Team Dropdown
      const teamDropdown = document.getElementById('teamDropdown');
      if (teamDropdown) {
        const button = teamDropdown.querySelector('.custom-dropdown-button');
        const menu = teamDropdown.querySelector('.custom-dropdown-menu');
        const hiddenSelect = teamDropdown.querySelector('select');
        
        // Set initial selected option
        const firstOption = menu.querySelector('.custom-dropdown-option[data-value=""]');
        if (firstOption) firstOption.classList.add('selected');
        
        button.addEventListener('click', (e) => {
          e.stopPropagation();
          const isOpen = menu.classList.contains('show');
          closeAllDropdowns();
          if (!isOpen) {
            menu.classList.add('show');
            button.classList.add('active');
          }
        });
        
        menu.addEventListener('click', (e) => {
          const option = e.target.closest('.custom-dropdown-option');
          if (option) {
            e.stopPropagation();
            const value = option.dataset.value || '';
            const text = option.textContent;
            
            button.querySelector('.custom-dropdown-text').textContent = text;
            menu.querySelectorAll('.custom-dropdown-option').forEach(opt => opt.classList.remove('selected'));
            option.classList.add('selected');
            
            if (hiddenSelect) {
              hiddenSelect.value = value;
              hiddenSelect.dispatchEvent(new Event('change'));
            }
            
            menu.classList.remove('show');
            button.classList.remove('active');
            filterUsers();
          }
        });
      }
      
      // Close dropdowns when clicking outside
      document.addEventListener('click', (e) => {
        if (!e.target.closest('.custom-dropdown')) {
          closeAllDropdowns();
        }
      });
    }
    
    function closeAllDropdowns() {
      document.querySelectorAll('.custom-dropdown-menu').forEach(menu => {
        menu.classList.remove('show');
      });
      document.querySelectorAll('.custom-dropdown-button').forEach(button => {
        button.classList.remove('active');
      });
    }
    
    // Initialize event listeners
    function initializeEventListeners() {
      // Advanced filter handlers
      const roleFilter = document.getElementById('roleFilter');
      const departmentFilter = document.getElementById('departmentFilter');
      const teamFilter = document.getElementById('teamFilter');
      
      // Create debounced function
      debouncedFilterUsers = AssetFlowUtils.debounce(filterUsers, 300);
      
      if (roleFilter) {
        roleFilter.onchange = filterUsers;
      }
      if (departmentFilter) {
        departmentFilter.onchange = filterUsers;
      }
      if (teamFilter) {
        teamFilter.onchange = filterUsers;
      }
    }
    
    // Initialize search input listener
    function initializeSearchInput() {
      const searchInput = document.getElementById('searchInput');
      if (searchInput) {
        // Create debounced function if not exists
        if (!debouncedFilterUsers) {
          debouncedFilterUsers = AssetFlowUtils.debounce(filterUsers, 300);
        }
        searchInput.oninput = debouncedFilterUsers;
      }
    }
    
    document.querySelectorAll('.sortable').forEach(th => {
      th.addEventListener('click', () => {
        const column = th.dataset.sort;
        sortTable(column);
      });
    });
    
    document.getElementById('pageSizeSelect')?.addEventListener('change', (e) => {
      changePageSize(e.target.value);
    });
    
    document.getElementById('addUserModal')?.addEventListener('click', (e) => {
      if (e.target.id === 'addUserModal') {
        closeAddUserModal();
      }
    });
    
    loadUsers();
  </script>
</body>
</html>

